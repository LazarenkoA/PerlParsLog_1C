# PerlParsLog_1C
Perl cкрипты для парса логов ТЖ
---
**CALL_BD.pl** - выводит время вызова без учета времени затраченное на СУБД (с учетом многострочного контекста события DBMSSQL).
Пример результата:

    Система.ПолучитьФорму:ЖурналДокументов.ЖурналОпераций.Форма.ФормаСписка;ОбщаяФорма.ФормаСтарт;ОбщаяФорма.СУ_ПодписаниеДокументов;ОбщаяФор>ма.ФормаВыбораТекущейОрганизации;Обработка.ИнформационныйЦентр.Форма.ИнформационныйЦентр;бработка.ПолнотекстовыйПоискВДанных.Форма.Упрощ>еннаяФорма-6822000 (~6.82 сек.)
    ОбщийМодуль.Вызов:ОбщийМодуль.ЛицензированиеСервер.Модуль.ПриНачалеРаботыСистемы-6442992 (~6.44 сек.)
    Система.ПолучитьФорму:Документ.РегистрацияОбязательствИСведенийПоДоговорам.ФормаОбъекта-5164006 (~5.16 сек.)
  

**parsMemory.pl** - Парс логов для работы с методикой https://kb.1c.ru/articleView.jsp?id=86.
В методике описан подход для анализа потребления памяти сеансовыми данными, скрипт написал без учета 
ISeanceContextStorage и seanceParametersPresave, т.е. для общего анализа потребления памяти.

**CallDurationsMem.pl** - Скрипт анализирует событие CALL, агрегирует длительность и потребление памяти за вызов. 
Принимает параметры:
* topn – где n – число, сколько строк нужно вывести, например top10 значит показать первые 10 строк результата.
* SortByMem - данный параметр означает, что сортировка будет по потреблению памяти (без этого параметра будет сортироваться по длительности). 
* GroupByDB - Результат будет выводиться с группировкой по БД (т.е. по свойству p:processName), имеет смысл применять когда логи у вас от разных БД, что   бы видить какая база больше потребляет памяти.
* SortByOneCall - Сортировка по значению за один вызов. Полезно использовать для нахождения самых длительных CALL'ов

Пример результата:
cat callscall/rphost_2624/18070511.log | perl 'D:/GIT/Perl/callDurationsMem.pl' top10

    ОбщийМодуль.Вызов:ОбщийМодуль.СУ.Модуль.ИзменитьСтатусОбъекта - ~ 16539.61 сек., ~ 275.66 мин. (вызов 1310 раз, среднее значение за вызов 12.63 сек.)
    Система.ПолучитьФорму:ЖурналДокументов.ЖурналОпераций.Форма.ФормаСписка;ОбщаяФорма.СУ_ПодписаниеДокументов;ОбщаяФорма.ФормаСтарт;ОбщаяФорма.ФормаВыбораТекущейОрганизации;Обработка.ИнформационныйЦентр.Форма.ИнформационныйЦентр;Обработка.ПолнотекстовыйПоискВДанных.Форма.УпрощеннаяФорма - ~ 2230.87 сек., ~ 37.18 мин. (вызов 161 раз, среднее значение за вызов 13.86 сек.)
    Форма.Записать:Документ.ЗаявкаНаКассовыйРасход.Форма.ФормаДокумента - ~ 2205.30 сек., ~ 36.76 мин. (вызов 426 раз, среднее значение за вызов 5.18 сек.)
    Система.ПолучитьФорму:Документ.СведенияПоДоговору.ФормаОбъекта - ~ 2006.14 сек., ~ 33.44 мин. (вызов 358 раз, среднее значение за вызов 5.60 сек.)
    Форма.Вызов:Документ.АктСверкиВзаиморасчетов.Форма.ФормаДокумента.Модуль.ЗаполнитьПоДаннымБухУчетаСервер - ~ 1995.65 сек., ~ 33.26 мин. (вызов 140 раз, среднее значение за вызов 14.25 сек.)
    Система.ПолучитьФорму:ОбщаяФорма.РасшифровкаРегламентированногоОтчетаЗарплата - ~ 1826.99 сек., ~ 30.45 мин. (вызов 26 раз, среднее значение за вызов 70.27 сек.)
    Форма.Прочитать:Документ.РасчетноПлатежныйДокумент.Форма.ФормаДокумента - ~ 1801.11 сек., ~ 30.02 мин. (вызов 1599 раз, среднее значение за вызов 1.13 сек.)
    Система.ПолучитьФорму:Отчет.КарточкаСчета.Форма.ФормаОтчета - ~ 1585.63 сек., ~ 26.43 мин. (вызов 419 раз, среднее значение за вызов 3.78 сек.)
    Форма.Вызов:Документ.СведенияПоДоговору.Форма.ФормаДокумента.Модуль.СУ_ОбновитьИнтерфейсНаСервере - ~ 1574.48 сек., ~ 26.24 мин. (вызов 964 раз, среднее значение за вызов 1.63 сек.)


 cat */rphost*/*.log | perl 'D:/GIT/Perl/callDurationsMem.pl' top10 SortByMem

    Форма.Вызов:Документ.РасчетноПлатежныйДокумент.Форма.ФормаДокумента.Модуль.УправлениеВидимостьюСозданияИного - ~ 3703440.70 Kb., ~3616.64 Mb. (вызов 2987 раз, среднее значение за вызов 1239.85 Kb.)
    Система.ПолучитьФорму:Документ.РегистрацияОбязательствИСведенийПоДоговорам.Форма.ФормаДокумента - ~ 3581440.74 Kb., ~3497.50 Mb. (вызов 928 раз, среднее значение за вызов 3859.31 Kb.)
    Форма.Вызов:Документ.СведенияПоДоговору.Форма.ФормаДокумента.Модуль.СУ_ОбновитьИнтерфейсНаСервере - ~ 2651309.93 Kb., ~2589.17 Mb. (вызов 964 раз, среднее значение за вызов 2750.32 Kb.)
    Форма.Вызов:Документ.СведенияПоДоговору.Форма.ФормаДокумента.Модуль.ПолучателиГрафика_ВычислимыеПоля_Заполнить - ~ 2546719.36 Kb., ~2487.03 Mb. (вызов 1682 раз, среднее значение за вызов 1514.10 Kb.)
    Система.ПолучитьФорму:Отчет.КарточкаСчета.Форма.ФормаОтчета - ~ 2350753.16 Kb., ~2295.66 Mb. (вызов 419 раз, среднее значение за вызов 5610.39 Kb.)
    Форма.Прочитать:Документ.РасчетноПлатежныйДокумент.Форма.ФормаДокумента - ~ 2307492.37 Kb., ~2253.41 Mb. (вызов 1599 раз, среднее значение за вызов 1443.08 Kb.)
    Система.ПолучитьФорму:Документ.СведенияПоДоговору.ФормаОбъекта - ~ 2196117.14 Kb., ~2144.65 Mb. (вызов 358 раз, среднее значение за вызов 6134.41 Kb.)
    Форма.Прочитать:Документ.СведенияПоДоговору.Форма.ФормаДокумента - ~ 1786141.50 Kb., ~1744.28 Mb. (вызов 660 раз, среднее значение за вызов 2706.28 Kb.)
    Форма.Вызов:Документ.РасчетноПлатежныйДокумент.Форма.ФормаДокумента.Модуль.СУ_ОбновитьИнтерфейсНаСервере - ~ 1622865.40 Kb., ~1584.83 Mb. (вызов 1042 раз, среднее значение за вызов 1557.45 Kb.)

**DurationsDB.pl** - Скрипт аналогичен CallDurationsMem.pl, только группирует по событию SDBL. Отсутствует параметр SortByMem